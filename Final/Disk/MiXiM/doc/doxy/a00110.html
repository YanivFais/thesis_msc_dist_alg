<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MiXiM: PhyLayerBattery Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>PhyLayerBattery Class Reference<br>
<small>
[<a class="el" href="a00318.html">Power consumption - Classes using/defining power consumption</a>,&nbsp;<a class="el" href="a00305.html">decider - decider modules</a>]</small>
</h1><!-- doxytag: class="PhyLayerBattery" --><!-- doxytag: inherits="PhyLayer" -->Extends <a class="el" href="a00109.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory...">PhyLayer</a> by adding power consumption for tx, rx and idle.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="a00466.html">PhyLayerBattery.h</a>&gt;</code>
<p>
Inherits <a class="el" href="a00109.html">PhyLayer</a>.
<p>
<div class="dynheader">
Collaboration diagram for PhyLayerBattery:</div>
<div class="dynsection">
<p><center><img src="a00999.png" border="0" usemap="#a01000" alt="Collaboration graph"></center>
<map name="a01000">
<area shape="rect" href="a00109.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory..." alt="" coords="27,5,101,32"></map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="a01001.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#815f95ad9fe89412ff3c5991ec1cfafe">initialize</a> (int stage)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OMNeT++ initialization function. Read simple parameters. Read and parse xml file for decider and analogue models configuration.  <a href="#815f95ad9fe89412ff3c5991ec1cfafe"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#73a5457ba5a50d2d061a4cbf7dbd96b3">handleUpperMessage</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks the hosts state and draws txCurrent from battery.  <a href="#73a5457ba5a50d2d061a4cbf7dbd96b3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#d6bd7ad4b0180287c2556066ed067c65">handleAirFrame</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if the the host state is on and prevents reception of AirFrames if not.  <a href="#d6bd7ad4b0180287c2556066ed067c65"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#808fc8fc16c1bd4d2e865a6dc897ff4d">handleSelfMessage</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Catches TX over messages to set current power consumption back for idle mode.  <a href="#808fc8fc16c1bd4d2e865a6dc897ff4d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#b687d180a389989e036e158765fe6f29">handleHostState</a> (const <a class="el" href="a00071.html">HostState</a> &amp;state)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Provides ability to draw power for the <a class="el" href="a00052.html" title="The basic Decider class.">Decider</a>.  <a href="#b687d180a389989e036e158765fe6f29"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7">Activities</a> { <a class="el" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7f8ca1afa02415cbbe5b6fd238c39d234">SLEEP_ACCT</a> = 0, 
<a class="el" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7cba49a8be79bc35b275f5c7fcc503d29">IDLE_ACCT</a> = 1, 
<a class="el" href="a00110.html#1eb13993a65f4147d7f99c936b4143c780381a36236673b743ebdec188ca5dbb">RX_ACCT</a> = 2, 
<a class="el" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7e1baed9a9981c073215cdd7c0a6658ab">TX_ACCT</a> = 3
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Defines the power consuming activities (accounts) of the NIC. Should be the same as defined in the decider.  <a href="a00110.html#1eb13993a65f4147d7f99c936b4143c7">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="a00052.html">Decider</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#7d09d3b83e7a6ad89682101aaa084579">getDeciderFromName</a> (std::string name, <a class="el" href="a00021.html#f29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;params)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Creates and returns an instance of the <a class="el" href="a00052.html" title="The basic Decider class.">Decider</a> with the specified name.  <a href="#7d09d3b83e7a6ad89682101aaa084579"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="a00052.html">Decider</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#85f00b8792329952e92264e16e133dcf">initializeDecider80211Battery</a> (<a class="el" href="a00021.html#f29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;params)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initializes a new <a class="el" href="a00054.html" title="Extends Decider80211 by drawing power during receiving of messages.">Decider80211Battery</a> from the passed parameter map.  <a href="#85f00b8792329952e92264e16e133dcf"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#0100994772e797d41df4c41b4b9ad475">numActivities</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of power consuming activities (accounts).  <a href="#0100994772e797d41df4c41b4b9ad475"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#15d15867a1ac057d60b8dc4a3771ce1b">sleepCurrent</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The different currents in mA.  <a href="#15d15867a1ac057d60b8dc4a3771ce1b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">idleCurrent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#43b742fc7d58613cd7cd82547ae72ab6">rxCurrent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00110.html#99d73bba9a336c5d544628eb898f06ae">txCurrent</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Extends <a class="el" href="a00109.html" title="Provides initialisation for several AnalogueModels and Deciders from modules directory...">PhyLayer</a> by adding power consumption for tx, rx and idle. 
<p>
Does two things, first before sending messages to the channel or receiving messages from the channel it checks the hosts current state. If the host is not able to send or the receive (e.g. no power) the messages are dropped. Draws tx current from battery during transmissions (starting on reception of message from upper layer until reception of TX_OVER message). And idle current any time else. Does also provide battery access to the <a class="el" href="a00052.html" title="The basic Decider class.">Decider</a> by implementing DeciderToPhyInterfaces "drawCurrent()"-method.<p>
Defines initialization for "Decider80211Battery". 
<p>Definition at line <a class="el" href="a00466.html#l00041">41</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>
<hr><h2>Member Enumeration Documentation</h2>
<a class="anchor" name="1eb13993a65f4147d7f99c936b4143c7"></a><!-- doxytag: member="PhyLayerBattery::Activities" ref="1eb13993a65f4147d7f99c936b4143c7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7">PhyLayerBattery::Activities</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Defines the power consuming activities (accounts) of the NIC. Should be the same as defined in the decider. 
<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="1eb13993a65f4147d7f99c936b4143c7f8ca1afa02415cbbe5b6fd238c39d234"></a><!-- doxytag: member="SLEEP_ACCT" ref="1eb13993a65f4147d7f99c936b4143c7f8ca1afa02415cbbe5b6fd238c39d234" args="" -->SLEEP_ACCT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="1eb13993a65f4147d7f99c936b4143c7cba49a8be79bc35b275f5c7fcc503d29"></a><!-- doxytag: member="IDLE_ACCT" ref="1eb13993a65f4147d7f99c936b4143c7cba49a8be79bc35b275f5c7fcc503d29" args="" -->IDLE_ACCT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="1eb13993a65f4147d7f99c936b4143c780381a36236673b743ebdec188ca5dbb"></a><!-- doxytag: member="RX_ACCT" ref="1eb13993a65f4147d7f99c936b4143c780381a36236673b743ebdec188ca5dbb" args="" -->RX_ACCT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="1eb13993a65f4147d7f99c936b4143c7e1baed9a9981c073215cdd7c0a6658ab"></a><!-- doxytag: member="TX_ACCT" ref="1eb13993a65f4147d7f99c936b4143c7e1baed9a9981c073215cdd7c0a6658ab" args="" -->TX_ACCT</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>Definition at line <a class="el" href="a00466.html#l00053">53</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00053"></a>00053                   {
<a name="l00054"></a>00054     <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7f8ca1afa02415cbbe5b6fd238c39d234">SLEEP_ACCT</a>=0,
<a name="l00055"></a>00055     <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7cba49a8be79bc35b275f5c7fcc503d29">IDLE_ACCT</a>=1,
<a name="l00056"></a>00056     <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c780381a36236673b743ebdec188ca5dbb">RX_ACCT</a>=2,
<a name="l00057"></a>00057     <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7e1baed9a9981c073215cdd7c0a6658ab">TX_ACCT</a>=3
<a name="l00058"></a>00058   };
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="7d09d3b83e7a6ad89682101aaa084579"></a><!-- doxytag: member="PhyLayerBattery::getDeciderFromName" ref="7d09d3b83e7a6ad89682101aaa084579" args="(std::string name, ParameterMap &amp;params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00052.html">Decider</a> * PhyLayerBattery::getDeciderFromName           </td>
          <td>(</td>
          <td class="paramtype">std::string&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00021.html#f29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Creates and returns an instance of the <a class="el" href="a00052.html" title="The basic Decider class.">Decider</a> with the specified name. 
<p>
Is able to initialize the following Deciders:<p>
<ul>
<li><a class="el" href="a00053.html" title="Decider for the 802.11 modules.">Decider80211</a></li><li><a class="el" href="a00054.html" title="Extends Decider80211 by drawing power during receiving of messages.">Decider80211Battery</a></li><li><a class="el" href="a00132.html" title="BaseDecider implementation which decides a signals correctness by checking its SNR...">SNRThresholdDecider</a> </li></ul>

<p>Reimplemented from <a class="el" href="a00109.html#a09a8558e04d2aba287be91d7fbd2548">PhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00465.html#l00042">42</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00465.html#l00050">initializeDecider80211Battery()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00042"></a>00042                                                                                  {
<a name="l00043"></a>00043   <span class="keywordflow">if</span>(name == <span class="stringliteral">"Decider80211Battery"</span>) {
<a name="l00044"></a>00044     <span class="keywordflow">return</span> <a class="code" href="a00110.html#85f00b8792329952e92264e16e133dcf" title="Initializes a new Decider80211Battery from the passed parameter map.">initializeDecider80211Battery</a>(params);
<a name="l00045"></a>00045   }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="keywordflow">return</span> <a class="code" href="a00110.html#7d09d3b83e7a6ad89682101aaa084579" title="Creates and returns an instance of the Decider with the specified name.">PhyLayer::getDeciderFromName</a>(name, params);
<a name="l00048"></a>00048 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d6bd7ad4b0180287c2556066ed067c65"></a><!-- doxytag: member="PhyLayerBattery::handleAirFrame" ref="d6bd7ad4b0180287c2556066ed067c65" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleAirFrame           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks if the the host state is on and prevents reception of AirFrames if not. 
<p>
Calls the base classes overriden method for normal handling. 
<p>Reimplemented from <a class="el" href="a00021.html#8d65e4a85336642f234bf0b1172336dc">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00465.html#l00086">86</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00398.html#l00042">HostState::FAILED</a>, <a class="el" href="a00398.html#l00061">HostState::get()</a>, <a class="el" href="a00347.html#l00163">BaseUtility::getHostState()</a>, and <a class="el" href="a00343.html#l00081">BaseModule::utility</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00086"></a>00086                                                   {
<a name="l00087"></a>00087   <span class="keywordflow">if</span> (<a class="code" href="a00019.html#3f177bbac706fb0113555679dc7c4500" title="Cached pointer to the utility module.">utility</a>-&gt;<a class="code" href="a00022.html#b7d9e59bf49cdfffe34ba0e53e38c76c" title="Get the current HostState.">getHostState</a>().<a class="code" href="a00071.html#3167de707748fd5280fce231d6cbcf90" title="Returns the host state.">get</a>() == <a class="code" href="a00071.html#5002302e0f07bbd982c6e5d65eaa9c3c1a8705dd49a3297fc8512a1ac63b78e7">HostState::FAILED</a>) {
<a name="l00088"></a>00088     EV&lt;&lt; <span class="stringliteral">"host has FAILED, dropping msg "</span> &lt;&lt; msg-&gt;getName() &lt;&lt; endl;
<a name="l00089"></a>00089     <span class="keyword">delete</span> msg;
<a name="l00090"></a>00090     <span class="keywordflow">return</span>;
<a name="l00091"></a>00091   }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <a class="code" href="a00110.html#d6bd7ad4b0180287c2556066ed067c65" title="Checks if the the host state is on and prevents reception of AirFrames if not.">PhyLayer::handleAirFrame</a>(msg);
<a name="l00094"></a>00094 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b687d180a389989e036e158765fe6f29"></a><!-- doxytag: member="PhyLayerBattery::handleHostState" ref="b687d180a389989e036e158765fe6f29" args="(const HostState &amp;state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleHostState           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="a00071.html">HostState</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>state</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Provides ability to draw power for the <a class="el" href="a00052.html" title="The basic Decider class.">Decider</a>. 
<p>
Method is defined in "DeciderToPhyInterface". Captures changes in host state. Note: Does not yet cancel any ongoing transmissions if the state changes to off. 
<p>Reimplemented from <a class="el" href="a00019.html#44220aa650488eee8ad121f8bc599265">BaseModule</a>.</p>

<p>Definition at line <a class="el" href="a00465.html#l00096">96</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00398.html#l00042">HostState::FAILED</a>, and <a class="el" href="a00398.html#l00061">HostState::get()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00096"></a>00096                                                             {
<a name="l00097"></a>00097   <span class="comment">// handles only battery consumption</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099   <a class="code" href="a00071.html#5002302e0f07bbd982c6e5d65eaa9c3c">HostState::States</a> hostState = state.<a class="code" href="a00071.html#3167de707748fd5280fce231d6cbcf90" title="Returns the host state.">get</a>();
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="keywordflow">switch</span> (hostState) {
<a name="l00102"></a>00102   <span class="keywordflow">case</span> <a class="code" href="a00071.html#5002302e0f07bbd982c6e5d65eaa9c3c1a8705dd49a3297fc8512a1ac63b78e7">HostState::FAILED</a>:
<a name="l00103"></a>00103     EV&lt;&lt; <span class="stringliteral">"t = "</span> &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">" host state FAILED"</span> &lt;&lt; endl;
<a name="l00104"></a>00104     <span class="comment">// it would be good to create a radioState OFF, as well</span>
<a name="l00105"></a>00105     <span class="keywordflow">break</span>;
<a name="l00106"></a>00106   <span class="keywordflow">default</span>:
<a name="l00107"></a>00107     <span class="keywordflow">break</span>;
<a name="l00108"></a>00108   }
<a name="l00109"></a>00109 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="808fc8fc16c1bd4d2e865a6dc897ff4d"></a><!-- doxytag: member="PhyLayerBattery::handleSelfMessage" ref="808fc8fc16c1bd4d2e865a6dc897ff4d" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleSelfMessage           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Catches TX over messages to set current power consumption back for idle mode. 
<p>
Calls the base classes overriden method for normal handling. 
<p>Reimplemented from <a class="el" href="a00021.html#17088ad93f59e143ff6c7ba866a31982">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00465.html#l00079">79</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00357.html#l00743">BasePhyLayer::drawCurrent()</a>, <a class="el" href="a00466.html#l00055">IDLE_ACCT</a>, <a class="el" href="a00466.html#l00047">idleCurrent</a>, and <a class="el" href="a00368.html#l00022">MacToPhyInterface::TX_OVER</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00079"></a>00079                                                      {
<a name="l00080"></a>00080   <span class="keywordflow">if</span>(msg-&gt;getKind() == <a class="code" href="a00090.html#36bc50a86bf1cc0f9efd374613d61a52b00e54021af4a33a84ac61a7543c7528">TX_OVER</a>) {
<a name="l00081"></a>00081     <a class="code" href="a00021.html#81153199f268b4831f42b20b06959764" title="Does nothing. For an actual power supporting phy see &amp;quot;PhyLayerBattery&amp;quot;...">drawCurrent</a>(<a class="code" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">idleCurrent</a>, <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7cba49a8be79bc35b275f5c7fcc503d29">IDLE_ACCT</a>);
<a name="l00082"></a>00082   }
<a name="l00083"></a>00083   <a class="code" href="a00110.html#808fc8fc16c1bd4d2e865a6dc897ff4d" title="Catches TX over messages to set current power consumption back for idle mode.">PhyLayer::handleSelfMessage</a>(msg);
<a name="l00084"></a>00084 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="73a5457ba5a50d2d061a4cbf7dbd96b3"></a><!-- doxytag: member="PhyLayerBattery::handleUpperMessage" ref="73a5457ba5a50d2d061a4cbf7dbd96b3" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::handleUpperMessage           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks the hosts state and draws txCurrent from battery. 
<p>
Prevents sending of AirFrames if the hosts state is not on. Sets current power consumption for TX mode. Calls the base classes overriden method for normal handling. 
<p>Reimplemented from <a class="el" href="a00021.html#17b1d469775962d23835dd5f43a639ac">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00465.html#l00067">67</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00357.html#l00743">BasePhyLayer::drawCurrent()</a>, <a class="el" href="a00398.html#l00042">HostState::FAILED</a>, <a class="el" href="a00398.html#l00061">HostState::get()</a>, <a class="el" href="a00347.html#l00163">BaseUtility::getHostState()</a>, <a class="el" href="a00466.html#l00057">TX_ACCT</a>, <a class="el" href="a00466.html#l00047">txCurrent</a>, and <a class="el" href="a00343.html#l00081">BaseModule::utility</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00067"></a>00067                                                       {
<a name="l00068"></a>00068   <span class="keywordflow">if</span> (<a class="code" href="a00019.html#3f177bbac706fb0113555679dc7c4500" title="Cached pointer to the utility module.">utility</a>-&gt;<a class="code" href="a00022.html#b7d9e59bf49cdfffe34ba0e53e38c76c" title="Get the current HostState.">getHostState</a>().<a class="code" href="a00071.html#3167de707748fd5280fce231d6cbcf90" title="Returns the host state.">get</a>() == <a class="code" href="a00071.html#5002302e0f07bbd982c6e5d65eaa9c3c1a8705dd49a3297fc8512a1ac63b78e7">HostState::FAILED</a>) {
<a name="l00069"></a>00069     EV&lt;&lt; <span class="stringliteral">"host has FAILED, dropping msg "</span> &lt;&lt; msg-&gt;getName() &lt;&lt; endl;
<a name="l00070"></a>00070     <span class="keyword">delete</span> msg;
<a name="l00071"></a>00071     <span class="keywordflow">return</span>;
<a name="l00072"></a>00072   }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074   <a class="code" href="a00110.html#73a5457ba5a50d2d061a4cbf7dbd96b3" title="Checks the hosts state and draws txCurrent from battery.">PhyLayer::handleUpperMessage</a>(msg);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076   <a class="code" href="a00021.html#81153199f268b4831f42b20b06959764" title="Does nothing. For an actual power supporting phy see &amp;quot;PhyLayerBattery&amp;quot;...">drawCurrent</a>(<a class="code" href="a00110.html#99d73bba9a336c5d544628eb898f06ae">txCurrent</a>, <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7e1baed9a9981c073215cdd7c0a6658ab">TX_ACCT</a>);
<a name="l00077"></a>00077 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="815f95ad9fe89412ff3c5991ec1cfafe"></a><!-- doxytag: member="PhyLayerBattery::initialize" ref="815f95ad9fe89412ff3c5991ec1cfafe" args="(int stage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PhyLayerBattery::initialize           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>stage</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
OMNeT++ initialization function. Read simple parameters. Read and parse xml file for decider and analogue models configuration. 
<p>

<p>Reimplemented from <a class="el" href="a00021.html#08704deaf03b73c8eda67cc60e670853">BasePhyLayer</a>.</p>

<p>Definition at line <a class="el" href="a00465.html#l00020">20</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00357.html#l00743">BasePhyLayer::drawCurrent()</a>, <a class="el" href="a00466.html#l00055">IDLE_ACCT</a>, <a class="el" href="a00466.html#l00047">idleCurrent</a>, <a class="el" href="a00466.html#l00044">numActivities</a>, <a class="el" href="a00350.html#l00015">BatteryAccess::registerWithBattery()</a>, <a class="el" href="a00466.html#l00047">rxCurrent</a>, <a class="el" href="a00466.html#l00047">sleepCurrent</a>, and <a class="el" href="a00466.html#l00047">txCurrent</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00020"></a>00020                                           {
<a name="l00021"></a>00021   <a class="code" href="a00110.html#815f95ad9fe89412ff3c5991ec1cfafe" title="OMNeT++ initialization function. Read simple parameters. Read and parse xml file...">PhyLayer::initialize</a>(stage);
<a name="l00022"></a>00022   <span class="keywordflow">if</span> (stage == 0) {
<a name="l00023"></a>00023     <a class="code" href="a00110.html#0100994772e797d41df4c41b4b9ad475" title="Number of power consuming activities (accounts).">numActivities</a> = hasPar(<span class="stringliteral">"numActivities"</span>) ? par(<span class="stringliteral">"numActivities"</span>).longValue() : 4;
<a name="l00024"></a>00024 
<a name="l00025"></a>00025     <span class="comment">/* parameters belong to the NIC, not just snrEval</span>
<a name="l00026"></a>00026 <span class="comment">     *</span>
<a name="l00027"></a>00027 <span class="comment">     * if/when variable transmit power is supported, txCurrent</span>
<a name="l00028"></a>00028 <span class="comment">     * should be specified as an xml table of available transmit</span>
<a name="l00029"></a>00029 <span class="comment">     * power levels and corresponding txCurrent */</span>
<a name="l00030"></a>00030     <a class="code" href="a00110.html#15d15867a1ac057d60b8dc4a3771ce1b" title="The different currents in mA.">sleepCurrent</a> = <a class="code" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">idleCurrent</a> = <a class="code" href="a00110.html#43b742fc7d58613cd7cd82547ae72ab6">rxCurrent</a> = <a class="code" href="a00110.html#99d73bba9a336c5d544628eb898f06ae">txCurrent</a> = 0;
<a name="l00031"></a>00031     <a class="code" href="a00110.html#15d15867a1ac057d60b8dc4a3771ce1b" title="The different currents in mA.">sleepCurrent</a> = getParentModule()-&gt;par( <span class="stringliteral">"sleepCurrent"</span> );
<a name="l00032"></a>00032     <a class="code" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">idleCurrent</a> = getParentModule()-&gt;par( <span class="stringliteral">"idleCurrent"</span> );
<a name="l00033"></a>00033     <a class="code" href="a00110.html#43b742fc7d58613cd7cd82547ae72ab6">rxCurrent</a> = getParentModule()-&gt;par( <span class="stringliteral">"rxCurrent"</span> );
<a name="l00034"></a>00034     <a class="code" href="a00110.html#99d73bba9a336c5d544628eb898f06ae">txCurrent</a> = getParentModule()-&gt;par( <span class="stringliteral">"txCurrent"</span> );
<a name="l00035"></a>00035   } <span class="keywordflow">else</span> {
<a name="l00036"></a>00036     <a class="code" href="a00025.html#2286e83003b2919cbb496260a5b0d009" title="Registers this module as a device with the battery module.">registerWithBattery</a>(<span class="stringliteral">"80211Nic"</span>, <a class="code" href="a00110.html#0100994772e797d41df4c41b4b9ad475" title="Number of power consuming activities (accounts).">numActivities</a>);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038     <a class="code" href="a00021.html#81153199f268b4831f42b20b06959764" title="Does nothing. For an actual power supporting phy see &amp;quot;PhyLayerBattery&amp;quot;...">drawCurrent</a>(<a class="code" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">idleCurrent</a>, <a class="code" href="a00110.html#1eb13993a65f4147d7f99c936b4143c7cba49a8be79bc35b275f5c7fcc503d29">IDLE_ACCT</a>);
<a name="l00039"></a>00039   }
<a name="l00040"></a>00040 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="85f00b8792329952e92264e16e133dcf"></a><!-- doxytag: member="PhyLayerBattery::initializeDecider80211Battery" ref="85f00b8792329952e92264e16e133dcf" args="(ParameterMap &amp;params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00052.html">Decider</a> * PhyLayerBattery::initializeDecider80211Battery           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00021.html#f29abf3259af16b051ce48b0db7a64c0">ParameterMap</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>params</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initializes a new <a class="el" href="a00054.html" title="Extends Decider80211 by drawing power during receiving of messages.">Decider80211Battery</a> from the passed parameter map. 
<p>

<p>Definition at line <a class="el" href="a00465.html#l00050">50</a> of file <a class="el" href="a00465.html">PhyLayerBattery.cc</a>.</p>

<p>References <a class="el" href="a00322.html#l00065">ChannelAccess::coreDebug</a>, <a class="el" href="a00342.html#l00086">BaseModule::findHost()</a>, <a class="el" href="a00466.html#l00047">idleCurrent</a>, <a class="el" href="a00466.html#l00047">rxCurrent</a>, and <a class="el" href="a00358.html#l00081">BasePhyLayer::sensitivity</a>.</p>

<p>Referenced by <a class="el" href="a00465.html#l00042">getDeciderFromName()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00050"></a>00050                                                                             {
<a name="l00051"></a>00051   <span class="keywordtype">double</span> threshold = params[<span class="stringliteral">"threshold"</span>];
<a name="l00052"></a>00052   <span class="keywordtype">double</span> centerFreq = params[<span class="stringliteral">"centerFrequency"</span>];
<a name="l00053"></a>00053   <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="a00054.html" title="Extends Decider80211 by drawing power during receiving of messages.">Decider80211Battery</a>(<span class="keyword">this</span>,
<a name="l00054"></a>00054                    threshold,
<a name="l00055"></a>00055                    <a class="code" href="a00021.html#7eaa041636b623066b5abd87a38afa25" title="The sensitivity describes the minimum strength a signal must have to be received...">sensitivity</a>,
<a name="l00056"></a>00056                    centerFreq,
<a name="l00057"></a>00057                    <a class="code" href="a00110.html#43b742fc7d58613cd7cd82547ae72ab6">rxCurrent</a>,
<a name="l00058"></a>00058                    <a class="code" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">idleCurrent</a>,
<a name="l00059"></a>00059                    <a class="code" href="a00019.html#abf0226159b22b46e70031fd3bb3b1b2" title="Function to get a pointer to the host module.">findHost</a>()-&gt;getIndex(),
<a name="l00060"></a>00060                    <a class="code" href="a00034.html#7f887e94fb15000c2c18b37dd208e556" title="debug this core module?">coreDebug</a>);
<a name="l00061"></a>00061 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="45de122b4fe14ce856654d72d5cae3ca"></a><!-- doxytag: member="PhyLayerBattery::idleCurrent" ref="45de122b4fe14ce856654d72d5cae3ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00110.html#45de122b4fe14ce856654d72d5cae3ca">PhyLayerBattery::idleCurrent</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00466.html#l00047">47</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>

<p>Referenced by <a class="el" href="a00465.html#l00079">handleSelfMessage()</a>, <a class="el" href="a00465.html#l00020">initialize()</a>, and <a class="el" href="a00465.html#l00050">initializeDecider80211Battery()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0100994772e797d41df4c41b4b9ad475"></a><!-- doxytag: member="PhyLayerBattery::numActivities" ref="0100994772e797d41df4c41b4b9ad475" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="a00110.html#0100994772e797d41df4c41b4b9ad475">PhyLayerBattery::numActivities</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Number of power consuming activities (accounts). 
<p>

<p>Definition at line <a class="el" href="a00466.html#l00044">44</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>

<p>Referenced by <a class="el" href="a00465.html#l00020">initialize()</a>.</p>

</div>
</div><p>
<a class="anchor" name="43b742fc7d58613cd7cd82547ae72ab6"></a><!-- doxytag: member="PhyLayerBattery::rxCurrent" ref="43b742fc7d58613cd7cd82547ae72ab6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00110.html#43b742fc7d58613cd7cd82547ae72ab6">PhyLayerBattery::rxCurrent</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00466.html#l00047">47</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>

<p>Referenced by <a class="el" href="a00465.html#l00020">initialize()</a>, and <a class="el" href="a00465.html#l00050">initializeDecider80211Battery()</a>.</p>

</div>
</div><p>
<a class="anchor" name="15d15867a1ac057d60b8dc4a3771ce1b"></a><!-- doxytag: member="PhyLayerBattery::sleepCurrent" ref="15d15867a1ac057d60b8dc4a3771ce1b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00110.html#15d15867a1ac057d60b8dc4a3771ce1b">PhyLayerBattery::sleepCurrent</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The different currents in mA. 
<p>

<p>Definition at line <a class="el" href="a00466.html#l00047">47</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>

<p>Referenced by <a class="el" href="a00465.html#l00020">initialize()</a>.</p>

</div>
</div><p>
<a class="anchor" name="99d73bba9a336c5d544628eb898f06ae"></a><!-- doxytag: member="PhyLayerBattery::txCurrent" ref="99d73bba9a336c5d544628eb898f06ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00110.html#99d73bba9a336c5d544628eb898f06ae">PhyLayerBattery::txCurrent</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00466.html#l00047">47</a> of file <a class="el" href="a00466.html">PhyLayerBattery.h</a>.</p>

<p>Referenced by <a class="el" href="a00465.html#l00067">handleUpperMessage()</a>, and <a class="el" href="a00465.html#l00020">initialize()</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>modules/phy/<a class="el" href="a00466.html">PhyLayerBattery.h</a><li>modules/phy/<a class="el" href="a00465.html">PhyLayerBattery.cc</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 28 15:57:07 2009 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
