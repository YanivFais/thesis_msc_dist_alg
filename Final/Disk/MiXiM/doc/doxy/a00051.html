<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MiXiM: CSMAMacLayer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>CSMAMacLayer Class Reference<br>
<small>
[<a class="el" href="a00302.html">macLayer - MAC layer modules</a>]</small>
</h1><!-- doxytag: class="CSMAMacLayer" --><!-- doxytag: inherits="BaseMacLayer" -->MAC module which provides non-persistent CSMA.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="a00433.html">CSMAMacLayer.h</a>&gt;</code>
<p>
Inherits <a class="el" href="a00017.html">BaseMacLayer</a>.
<p>
<div class="dynheader">
Collaboration diagram for CSMAMacLayer:</div>
<div class="dynsection">
<p><center><img src="a00864.png" border="0" usemap="#a00865" alt="Collaboration graph"></center>
<map name="a00865">
<area shape="rect" href="a00017.html" title="A very simple MAC module template which provides de&#45; and encapsulation of messages..." alt="" coords="9,5,116,32"></map>
<center><font size="2">[<a target="top" href="graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="a00866.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#660262c629f33b00401249d3fdac49be">initialize</a> (int)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialization of the module and some variables.  <a href="#660262c629f33b00401249d3fdac49be"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#eaffa0655b4e87224a9a2f09b96805d7">finish</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete all dynamically allocated objects of the module.  <a href="#eaffa0655b4e87224a9a2f09b96805d7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#83911b5673de047bcfc3c9b0a719ff15">handleLowerMsg</a> (cMessage *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle messages from lower layer.  <a href="#83911b5673de047bcfc3c9b0a719ff15"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#06c96c060afdff5c0f348b5ebef5c54d">handleUpperMsg</a> (cMessage *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle messages from upper layer.  <a href="#06c96c060afdff5c0f348b5ebef5c54d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#254a29c1cc1f0292039d57c1d189cda3">handleSelfMsg</a> (cMessage *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle self messages such as timers.  <a href="#254a29c1cc1f0292039d57c1d189cda3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#2eb12cedf0b4b5e6fda8bd6666186cb6">handleLowerControl</a> (cMessage *msg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle control messages from lower layer.  <a href="#2eb12cedf0b4b5e6fda8bd6666186cb6"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Types</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f0654913">States</a> { <a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>, 
<a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca">CCA</a>, 
<a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0">TX</a>
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">MAC states.  <a href="a00051.html#a504ef94f12cc702c82a81f5f0654913">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef std::list&lt; cPacket * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#f397ee30d94486721632bbcdad8274d1">MacQueue</a></td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#a4ace66cbd53164dc27f4fba70dd60b4">scheduleBackoff</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Inspect reasons for dropped packets.  <a href="#a4ace66cbd53164dc27f4fba70dd60b4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual MacPkt *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#12641a9e99a3064797647cf3b4946824">encapsMsg</a> (cPacket *pkt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Encapsulates the NetwPkt into the MacPkt and sets the parameters.  <a href="#12641a9e99a3064797647cf3b4946824"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f0654913">States</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907">macState</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">kepp track of MAC state  <a href="#a78817d8e3bbf7850e5d84a6377ea907"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#420bec99b62f029c75996930bc5cb56f">slotDuration</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">RSSI level where medium is considered busy.  <a href="#420bec99b62f029c75996930bc5cb56f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#5a0fde63ac12cccfdb98bfe6314ce46d">difs</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Maximum time between a packet and its ACK.  <a href="#5a0fde63ac12cccfdb98bfe6314ce46d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00051.html#f397ee30d94486721632bbcdad8274d1">MacQueue</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19">macQueue</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">cached pointer to radio module  <a href="#9869bd7667eacdb3a9c5f8ecb0c3ed19"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#27628021750dc0e8cf651382663276b8">queueLength</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">length of the queue  <a href="#27628021750dc0e8cf651382663276b8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#946e29bb8fead33566797a7062649a1e">backoffTimer</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><a class="el" href="a00137.html">Timer</a> for backoff (non-persistent CSMA).  <a href="#946e29bb8fead33566797a7062649a1e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">cMessage *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#f06855c96a26dbe77937062bead7f82c">minorMsg</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Multi-purpose message.  <a href="#f06855c96a26dbe77937062bead7f82c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b">txAttempts</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">count the number of tx attempts  <a href="#6c9b1b0f5eeb45db611633ca986f537b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#e3aa6dae3903cabacbcafe783ef33d91">maxTxAttempts</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">maximum number of transmission attempts  <a href="#e3aa6dae3903cabacbcafe783ef33d91"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#70ae938b76fa8fe65d97b0b511767894">bitrate</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the bit rate at which we transmit  <a href="#70ae938b76fa8fe65d97b0b511767894"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#619cc05568e8ebef57ff9c551cd311d0">txPower</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The power at which we transmit.  <a href="#619cc05568e8ebef57ff9c551cd311d0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00051.html#8ec2aea0983e2149d3c7d1c06637dd70">initialCW</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initial contention window size  <a href="#8ec2aea0983e2149d3c7d1c06637dd70"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
MAC module which provides non-persistent CSMA. 
<p>
This is an implementation of a simple non-persistent CSMA. The idea of nonpersistent CSMA is "listen before talk". Before attempting to transmit, a station will sense the medium for a carrier signal, which, if present, indicates that some other station is sending.<p>
If the channel is busy a random waiting time is computed and after this time the channel is sensed again. Once the channel gets idle the message is sent. (State of the channel is obtained from <a class="el" href="a00035.html" title="This class is used by the BasePhyLayer to keep track of the AirFrames on the channel...">ChannelInfo</a> via phyLayer.)<p>
An option of this module is to use a queue. If a packet from the upper layer arrives although there is still another packet waiting for its transmission or being transmitted the new packet can be stored in this queue. The length of this queue can be specified by the user in the omnetpp.ini file. By default the length is 0. If the queue is full or there is no queue (length = 0) new packet(s) will be deleted.<p>
ATTENTION: Imagine the following scenario:<p>
Several stations receive a broadcast request packet, usally exactly at the same time. They will all try to answer at exactly the same time, i.e. they all will sense the channel at exactly the same time and start to transmit because the channel was sensed idle by all of them. Therefore a small random delay should be built into one/some of the upper layers to simulate a random processing time!<p>
The <a class="el" href="a00133.html" title="Test class for the application layer.">TestApplLayer</a> e.g. implements such a processing delay!<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Marc L�bbers, Yosia Hadisusanto, Andreas Koepke, Karl Wessel </dd></dl>

<p>Definition at line <a class="el" href="a00433.html#l00050">50</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>
<hr><h2>Member Typedef Documentation</h2>
<a class="anchor" name="f397ee30d94486721632bbcdad8274d1"></a><!-- doxytag: member="CSMAMacLayer::MacQueue" ref="f397ee30d94486721632bbcdad8274d1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::list&lt;cPacket*&gt; <a class="el" href="a00051.html#f397ee30d94486721632bbcdad8274d1">CSMAMacLayer::MacQueue</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00433.html#l00074">74</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

</div>
</div><p>
<hr><h2>Member Enumeration Documentation</h2>
<a class="anchor" name="a504ef94f12cc702c82a81f5f0654913"></a><!-- doxytag: member="CSMAMacLayer::States" ref="a504ef94f12cc702c82a81f5f0654913" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f0654913">CSMAMacLayer::States</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
MAC states. 
<p>
The MAC states help to keep track what the MAC is actually trying to do -- this is esp. useful when radio switching takes some time. RX -- MAC accepts packets from PHY layer TX -- MAC transmits a packet CCA -- Clear Channel Assessment - MAC checks whether medium is busy <dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631"></a><!-- doxytag: member="RX" ref="a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631" args="" -->RX</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca"></a><!-- doxytag: member="CCA" ref="a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca" args="" -->CCA</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0"></a><!-- doxytag: member="TX" ref="a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0" args="" -->TX</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>Definition at line <a class="el" href="a00433.html#l00087">87</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00087"></a>00087                 {
<a name="l00088"></a>00088         <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>,
<a name="l00089"></a>00089         <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca">CCA</a>,
<a name="l00090"></a>00090         <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0">TX</a>,
<a name="l00091"></a>00091     };
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="12641a9e99a3064797647cf3b4946824"></a><!-- doxytag: member="CSMAMacLayer::encapsMsg" ref="12641a9e99a3064797647cf3b4946824" args="(cPacket *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MacPkt * CSMAMacLayer::encapsMsg           </td>
          <td>(</td>
          <td class="paramtype">cPacket *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Encapsulates the NetwPkt into the MacPkt and sets the parameters. 
<p>

<p>Reimplemented from <a class="el" href="a00017.html#32d47cbd6940c09071e0f0e777cf6716">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00432.html#l00271">271</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00151">bitrate</a>, <a class="el" href="a00338.html#l00152">BaseMacLayer::createSignal()</a>, <a class="el" href="a00433.html#l00107">slotDuration</a>, and <a class="el" href="a00433.html#l00154">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00208">handleLowerControl()</a>, <a class="el" href="a00432.html#l00091">handleUpperMsg()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00272"></a>00272 {
<a name="l00273"></a>00273   MacPkt* macPkt = <a class="code" href="a00051.html#12641a9e99a3064797647cf3b4946824" title="Encapsulates the NetwPkt into the MacPkt and sets the parameters.">BaseMacLayer::encapsMsg</a>(pkt);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275   <span class="comment">//calc signal duration</span>
<a name="l00276"></a>00276   simtime_t duration = macPkt-&gt;getBitLength() / <a class="code" href="a00051.html#70ae938b76fa8fe65d97b0b511767894" title="the bit rate at which we transmit">bitrate</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278   <span class="keywordflow">if</span>(duration &gt; <a class="code" href="a00051.html#420bec99b62f029c75996930bc5cb56f" title="RSSI level where medium is considered busy.">slotDuration</a>) {
<a name="l00279"></a>00279     EV &lt;&lt; <span class="stringliteral">"Warning: Sending packet "</span> &lt;&lt; pkt
<a name="l00280"></a>00280        &lt;&lt; <span class="stringliteral">" - duration ("</span> &lt;&lt; duration
<a name="l00281"></a>00281        &lt;&lt; <span class="stringliteral">" ) is bigger than the slot duration ("</span> &lt;&lt; <a class="code" href="a00051.html#420bec99b62f029c75996930bc5cb56f" title="RSSI level where medium is considered busy.">slotDuration</a>
<a name="l00282"></a>00282        &lt;&lt;<span class="stringliteral">")."</span> &lt;&lt; endl;
<a name="l00283"></a>00283   }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="comment">//create signal</span>
<a name="l00286"></a>00286   <a class="code" href="a00124.html" title="The signal class stores the physical representation of the signal of an AirFrame...">Signal</a>* s = <a class="code" href="a00017.html#8815bb8f7fdd9e341819fb62d8141bad" title="Creates a simple Signal defined over time with the passed parameters.">createSignal</a>(simTime(), duration, <a class="code" href="a00051.html#619cc05568e8ebef57ff9c551cd311d0" title="The power at which we transmit.">txPower</a>, <a class="code" href="a00051.html#70ae938b76fa8fe65d97b0b511767894" title="the bit rate at which we transmit">bitrate</a>);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <span class="comment">//create and initialize control info</span>
<a name="l00289"></a>00289   <a class="code" href="a00089.html" title="Stores information which is needed by the physical layer when sending a MacPkt.">MacToPhyControlInfo</a>* ctrl = <span class="keyword">new</span> <a class="code" href="a00089.html" title="Stores information which is needed by the physical layer when sending a MacPkt.">MacToPhyControlInfo</a>(s);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   macPkt-&gt;setControlInfo(ctrl);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="keywordflow">return</span> macPkt;
<a name="l00294"></a>00294 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="eaffa0655b4e87224a9a2f09b96805d7"></a><!-- doxytag: member="CSMAMacLayer::finish" ref="eaffa0655b4e87224a9a2f09b96805d7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::finish           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Delete all dynamically allocated objects of the module. 
<p>

<p>Reimplemented from <a class="el" href="a00016.html#5ab11502dbeeea89693d29841376a2f7">BaseLayer</a>.</p>

<p>Definition at line <a class="el" href="a00432.html#l00059">59</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00127">backoffTimer</a>, <a class="el" href="a00433.html#l00121">macQueue</a>, and <a class="el" href="a00433.html#l00134">minorMsg</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00059"></a>00059                           {
<a name="l00060"></a>00060     <span class="keywordflow">if</span> (<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled())
<a name="l00061"></a>00061       cancelEvent(<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>);
<a name="l00062"></a>00062   <span class="keyword">delete</span> <a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>;
<a name="l00063"></a>00063   <a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a> = 0;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     <span class="keywordflow">if</span> (<a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a>-&gt;isScheduled())
<a name="l00066"></a>00066       cancelEvent(<a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a>);
<a name="l00067"></a>00067   <span class="keyword">delete</span> <a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a>;
<a name="l00068"></a>00068   <a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a> = 0;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     <span class="keywordflow">for</span>(MacQueue::iterator it = <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.begin();
<a name="l00071"></a>00071     it != <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.end(); ++it)
<a name="l00072"></a>00072     {
<a name="l00073"></a>00073         <span class="keyword">delete</span> (*it);
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075     <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.clear();
<a name="l00076"></a>00076 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2eb12cedf0b4b5e6fda8bd6666186cb6"></a><!-- doxytag: member="CSMAMacLayer::handleLowerControl" ref="2eb12cedf0b4b5e6fda8bd6666186cb6" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleLowerControl           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle control messages from lower layer. 
<p>

<p>Reimplemented from <a class="el" href="a00017.html#796d456d593dfab3188b37e506dd76a8">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00432.html#l00208">208</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00127">backoffTimer</a>, <a class="el" href="a00432.html#l00271">encapsMsg()</a>, <a class="el" href="a00090.html#8447e9cc66ba633aa11a59387cce477c">MacToPhyInterface::getRadioState()</a>, <a class="el" href="a00433.html#l00121">macQueue</a>, <a class="el" href="a00433.html#l00094">macState</a>, <a class="el" href="a00339.html#l00061">BaseMacLayer::phy</a>, <a class="el" href="a00368.html#l00024">MacToPhyInterface::RADIO_SWITCHING_OVER</a>, <a class="el" href="a00377.html#l00245">Radio::RX</a>, <a class="el" href="a00433.html#l00088">RX</a>, <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>, <a class="el" href="a00336.html#l00108">BaseLayer::sendDown()</a>, <a class="el" href="a00090.html#d25abbad9aa16bdbf24bf1dd582b1c6f">MacToPhyInterface::setRadioState()</a>, <a class="el" href="a00377.html#l00247">Radio::TX</a>, <a class="el" href="a00433.html#l00090">TX</a>, <a class="el" href="a00368.html#l00022">MacToPhyInterface::TX_OVER</a>, and <a class="el" href="a00433.html#l00142">txAttempts</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00209"></a>00209 {
<a name="l00210"></a>00210     <span class="keywordflow">if</span>(msg-&gt;getKind() == <a class="code" href="a00090.html#36bc50a86bf1cc0f9efd374613d61a52b00e54021af4a33a84ac61a7543c7528">MacToPhyInterface::TX_OVER</a>) {
<a name="l00211"></a>00211         EV &lt;&lt; <span class="stringliteral">" transmission over"</span> &lt;&lt; endl;
<a name="l00212"></a>00212         <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> = <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>;
<a name="l00213"></a>00213         <a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#d25abbad9aa16bdbf24bf1dd582b1c6f" title="Tells the BasePhyLayer to switch to the specified radio state.">setRadioState</a>(<a class="code" href="a00112.html#7314de88eaecfa054e682ccc84ef0ffa0a9f9ba2fd83cf0f5f4eaf4f32d6a9c1">Radio::RX</a>);
<a name="l00214"></a>00214         <a class="code" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b" title="count the number of tx attempts">txAttempts</a> = 0;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(msg-&gt;getKind() == <a class="code" href="a00090.html#36bc50a86bf1cc0f9efd374613d61a52876c7366bd2bcb675b41e60007831d06">MacToPhyInterface::RADIO_SWITCHING_OVER</a>) {
<a name="l00217"></a>00217       <span class="keywordflow">if</span>((<a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> == <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0">TX</a>) &amp;&amp; (<a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#8447e9cc66ba633aa11a59387cce477c" title="Returns the current state the radio is in. See RadioState for possible values.">getRadioState</a>() == <a class="code" href="a00112.html#7314de88eaecfa054e682ccc84ef0ffa55eab2480eb0876c6b76dc0df92882f7">Radio::TX</a>)) {
<a name="l00218"></a>00218             EV &lt;&lt; <span class="stringliteral">" radio switched to tx, sendDown packet"</span> &lt;&lt; endl;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220             <a class="code" href="a00016.html#1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(<a class="code" href="a00051.html#12641a9e99a3064797647cf3b4946824" title="Encapsulates the NetwPkt into the MacPkt and sets the parameters.">encapsMsg</a>(<a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.front()));
<a name="l00221"></a>00221             <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.pop_front();
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224     <span class="keywordflow">else</span> {
<a name="l00225"></a>00225         EV &lt;&lt; <span class="stringliteral">"control message with wrong kind -- deleting\n"</span>;
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keyword">delete</span> msg;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="keywordflow">if</span>(!<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled()) <a class="code" href="a00051.html#a4ace66cbd53164dc27f4fba70dd60b4" title="Inspect reasons for dropped packets.">scheduleBackoff</a>();
<a name="l00230"></a>00230 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="83911b5673de047bcfc3c9b0a719ff15"></a><!-- doxytag: member="CSMAMacLayer::handleLowerMsg" ref="83911b5673de047bcfc3c9b0a719ff15" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleLowerMsg           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle messages from lower layer. 
<p>
Compare the address of this Host with the destination address in frame. If they are equal or the frame is broadcast, we send this frame to the upper layer. If not delete it. 
<p>Reimplemented from <a class="el" href="a00017.html#413375cec02b990a521b62086a02264c">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00432.html#l00190">190</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00127">backoffTimer</a>, <a class="el" href="a00338.html#l00055">BaseMacLayer::decapsMsg()</a>, <a class="el" href="a00404.html#l00032">L2BROADCAST</a>, <a class="el" href="a00339.html#l00071">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>, and <a class="el" href="a00336.html#l00113">BaseLayer::sendUp()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00191"></a>00191 {
<a name="l00192"></a>00192     MacPkt *mac = <span class="keyword">static_cast&lt;</span>MacPkt *<span class="keyword">&gt;</span>(msg);
<a name="l00193"></a>00193     <span class="keywordtype">int</span> dest = mac-&gt;getDestAddr();
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">if</span>(dest == <a class="code" href="a00017.html#b4c8f97d540fc49277ab3a08e41a0c6f" title="MAC address (simply module id).">myMacAddr</a> || dest == <a class="code" href="a00307.html#gg06fc87d81c62e9abb8790b6e5713c55b7f19df32f2804a6a4898283c48208a80">L2BROADCAST</a>)
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197         EV &lt;&lt; <span class="stringliteral">"sending pkt to upper...\n"</span>;
<a name="l00198"></a>00198         <a class="code" href="a00016.html#dbf061566606041db811b519f0400ed5" title="Sends a message to the upper layer.">sendUp</a>(<a class="code" href="a00017.html#b5c40c53eda6e5a5041bddebfab6e0b6" title="decapsulate the network message from the MacPkt">decapsMsg</a>(mac));
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200     <span class="keywordflow">else</span> {
<a name="l00201"></a>00201         EV &lt;&lt; <span class="stringliteral">"packet not for me, deleting...\n"</span>;
<a name="l00202"></a>00202         <span class="keyword">delete</span> mac;
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205     <span class="keywordflow">if</span>(!<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled()) <a class="code" href="a00051.html#a4ace66cbd53164dc27f4fba70dd60b4" title="Inspect reasons for dropped packets.">scheduleBackoff</a>();
<a name="l00206"></a>00206 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="254a29c1cc1f0292039d57c1d189cda3"></a><!-- doxytag: member="CSMAMacLayer::handleSelfMsg" ref="254a29c1cc1f0292039d57c1d189cda3" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleSelfMsg           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle self messages such as timers. 
<p>
After the timer expires try to retransmit the message by calling handleUpperMsg again. 
<p>Reimplemented from <a class="el" href="a00017.html#95ce03241a7dd66baa693607a74eca07">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00432.html#l00128">128</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00127">backoffTimer</a>, <a class="el" href="a00433.html#l00089">CCA</a>, <a class="el" href="a00433.html#l00114">difs</a>, <a class="el" href="a00090.html#24e146616912b4a59df91a12b81a38cf">MacToPhyInterface::getChannelState()</a>, <a class="el" href="a00090.html#8447e9cc66ba633aa11a59387cce477c">MacToPhyInterface::getRadioState()</a>, <a class="el" href="a00361.html#l00003">ChannelState::isIdle()</a>, <a class="el" href="a00433.html#l00121">macQueue</a>, <a class="el" href="a00433.html#l00094">macState</a>, <a class="el" href="a00433.html#l00134">minorMsg</a>, <a class="el" href="a00339.html#l00061">BaseMacLayer::phy</a>, <a class="el" href="a00377.html#l00245">Radio::RX</a>, <a class="el" href="a00433.html#l00088">RX</a>, <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>, <a class="el" href="a00090.html#d25abbad9aa16bdbf24bf1dd582b1c6f">MacToPhyInterface::setRadioState()</a>, <a class="el" href="a00377.html#l00247">Radio::TX</a>, and <a class="el" href="a00433.html#l00090">TX</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00129"></a>00129 {
<a name="l00130"></a>00130     <span class="keywordflow">if</span>(msg == <a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>) {
<a name="l00131"></a>00131         EV &lt;&lt; <span class="stringliteral">"backoffTimer "</span>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">if</span>(<a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> == <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>) {
<a name="l00134"></a>00134             EV &lt;&lt; <span class="stringliteral">" RX "</span>;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136             <span class="keywordflow">if</span>(<a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.size() != 0) {
<a name="l00137"></a>00137               <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> = <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca">CCA</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139                 <span class="keywordflow">if</span>(<a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#8447e9cc66ba633aa11a59387cce477c" title="Returns the current state the radio is in. See RadioState for possible values.">getRadioState</a>() == <a class="code" href="a00112.html#7314de88eaecfa054e682ccc84ef0ffa0a9f9ba2fd83cf0f5f4eaf4f32d6a9c1">Radio::RX</a>) {
<a name="l00140"></a>00140 
<a name="l00141"></a>00141                     <span class="keywordflow">if</span>(<a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#24e146616912b4a59df91a12b81a38cf" title="Returns the current state of the channel. See ChannelState for details.">getChannelState</a>().<a class="code" href="a00037.html#c171088d0d716316bc523511d4e53771" title="Returns true if the channel is considered idle, meaning depends on the used decider...">isIdle</a>()) {
<a name="l00142"></a>00142                         EV &lt;&lt; <span class="stringliteral">" idle "</span>;
<a name="l00143"></a>00143                         scheduleAt(simTime()+<a class="code" href="a00051.html#5a0fde63ac12cccfdb98bfe6314ce46d" title="Maximum time between a packet and its ACK.">difs</a>, <a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a>);
<a name="l00144"></a>00144                     }
<a name="l00145"></a>00145                     <span class="keywordflow">else</span>{
<a name="l00146"></a>00146                       <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> = <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>;
<a name="l00147"></a>00147                         EV &lt;&lt; <span class="stringliteral">" busy "</span>;
<a name="l00148"></a>00148                         <a class="code" href="a00051.html#a4ace66cbd53164dc27f4fba70dd60b4" title="Inspect reasons for dropped packets.">scheduleBackoff</a>();
<a name="l00149"></a>00149                     }
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151             }
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153         <span class="keywordflow">else</span> {
<a name="l00154"></a>00154           EV &lt;&lt; <span class="stringliteral">""</span> &lt;&lt; endl;
<a name="l00155"></a>00155           EV &lt;&lt; <span class="stringliteral">"state="</span> &lt;&lt; <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> &lt;&lt; <span class="stringliteral">"(TX="</span>&lt;&lt;<a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0">TX</a>&lt;&lt;<span class="stringliteral">", CCA="</span>&lt;&lt;<a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca">CCA</a>&lt;&lt;<span class="stringliteral">")\n"</span>;
<a name="l00156"></a>00156             error(<span class="stringliteral">"backoffTimer expired, MAC in wrong state"</span>);
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(msg == <a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a>) {
<a name="l00160"></a>00160         EV &lt;&lt; <span class="stringliteral">" minorMsg "</span>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         <span class="comment">//TODO: replace with channel sense request</span>
<a name="l00163"></a>00163         <span class="keywordflow">if</span>((<a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> == <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913cd80830b40d6cc8615ea4ff537cb37ca">CCA</a>) &amp;&amp; (<a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#8447e9cc66ba633aa11a59387cce477c" title="Returns the current state the radio is in. See RadioState for possible values.">getRadioState</a>() == <a class="code" href="a00112.html#7314de88eaecfa054e682ccc84ef0ffa0a9f9ba2fd83cf0f5f4eaf4f32d6a9c1">Radio::RX</a>)) {
<a name="l00164"></a>00164 
<a name="l00165"></a>00165             <span class="keywordflow">if</span>(<a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#24e146616912b4a59df91a12b81a38cf" title="Returns the current state of the channel. See ChannelState for details.">getChannelState</a>().<a class="code" href="a00037.html#c171088d0d716316bc523511d4e53771" title="Returns true if the channel is considered idle, meaning depends on the used decider...">isIdle</a>()) {
<a name="l00166"></a>00166                 EV &lt;&lt; <span class="stringliteral">" idle -&gt; to send "</span>;
<a name="l00167"></a>00167                 <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> = <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f065491318461bd2358689c90c3c5cade629e0b0">TX</a>;
<a name="l00168"></a>00168                 <a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#d25abbad9aa16bdbf24bf1dd582b1c6f" title="Tells the BasePhyLayer to switch to the specified radio state.">setRadioState</a>(<a class="code" href="a00112.html#7314de88eaecfa054e682ccc84ef0ffa55eab2480eb0876c6b76dc0df92882f7">Radio::TX</a>);
<a name="l00169"></a>00169             }
<a name="l00170"></a>00170             <span class="keywordflow">else</span> {
<a name="l00171"></a>00171                 EV &lt;&lt; <span class="stringliteral">" busy -&gt; backoff "</span>;
<a name="l00172"></a>00172                 <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> = <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>;
<a name="l00173"></a>00173                 <span class="keywordflow">if</span>(!<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled())
<a name="l00174"></a>00174                   <a class="code" href="a00051.html#a4ace66cbd53164dc27f4fba70dd60b4" title="Inspect reasons for dropped packets.">scheduleBackoff</a>();
<a name="l00175"></a>00175             }
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         <span class="keywordflow">else</span> {
<a name="l00178"></a>00178             error(<span class="stringliteral">"minClearTimer fired -- channel or mac in wrong state"</span>);
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181     EV &lt;&lt; endl;
<a name="l00182"></a>00182 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="06c96c060afdff5c0f348b5ebef5c54d"></a><!-- doxytag: member="CSMAMacLayer::handleUpperMsg" ref="06c96c060afdff5c0f348b5ebef5c54d" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::handleUpperMsg           </td>
          <td>(</td>
          <td class="paramtype">cMessage *&nbsp;</td>
          <td class="paramname"> <em>msg</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle messages from upper layer. 
<p>
First it has to be checked whether a frame is currently being transmitted or waiting to be transmitted. If so the newly arrived message is stored in a queue. If there is no queue or it is full print a warning.<p>
Before transmitting a frame it is tested whether the channel is busy at the moment or not. If the channel is busy, a short random time will be generated and the MacPkt is buffered for this time, before a next attempt to send the packet is started.<p>
If channel is idle the frame will be transmitted immediately. 
<p>Reimplemented from <a class="el" href="a00017.html#6de2ca07018de313a7147a03e6d77bff">BaseMacLayer</a>.</p>

<p>Definition at line <a class="el" href="a00432.html#l00091">91</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00127">backoffTimer</a>, <a class="el" href="a00432.html#l00271">encapsMsg()</a>, <a class="el" href="a00433.html#l00121">macQueue</a>, <a class="el" href="a00433.html#l00094">macState</a>, <a class="el" href="a00339.html#l00053">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00433.html#l00124">queueLength</a>, <a class="el" href="a00433.html#l00088">RX</a>, <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>, and <a class="el" href="a00336.html#l00118">BaseLayer::sendControlUp()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093   cPacket* pkt = <span class="keyword">static_cast&lt;</span>cPacket*<span class="keyword">&gt;</span>(msg);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="comment">//MacPkt *mac = encapsMsg(pkt);</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="comment">// message has to be queued if another message is waiting to be send</span>
<a name="l00098"></a>00098     <span class="comment">// or if we are already trying to send another message</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keywordflow">if</span> (<a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.size() &lt;= <a class="code" href="a00051.html#27628021750dc0e8cf651382663276b8" title="length of the queue">queueLength</a>)
<a name="l00101"></a>00101     {
<a name="l00102"></a>00102         <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.push_back(pkt);
<a name="l00103"></a>00103     EV  &lt;&lt; <span class="stringliteral">"packet putt in queue\n  queue size:"</span> &lt;&lt; <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.size() &lt;&lt; <span class="stringliteral">" macState:"</span> &lt;&lt; <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a>
<a name="l00104"></a>00104       &lt;&lt; <span class="stringliteral">" (RX="</span> &lt;&lt; <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a> &lt;&lt; <span class="stringliteral">") is scheduled:"</span> &lt;&lt; <a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled() &lt;&lt; endl;;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="keywordflow">if</span>((<a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.size() == 1) &amp;&amp; (<a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> == <a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>) &amp;&amp; !<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled()) {
<a name="l00107"></a>00107             <a class="code" href="a00051.html#a4ace66cbd53164dc27f4fba70dd60b4" title="Inspect reasons for dropped packets.">scheduleBackoff</a>();
<a name="l00108"></a>00108         }
<a name="l00109"></a>00109     }
<a name="l00110"></a>00110     <span class="keywordflow">else</span> {
<a name="l00111"></a>00111         <span class="comment">// queue is full, message has to be deleted</span>
<a name="l00112"></a>00112         EV &lt;&lt; <span class="stringliteral">"New packet arrived, but queue is FULL, so new packet is deleted\n"</span>;
<a name="l00113"></a>00113         MacPkt* mac = <a class="code" href="a00051.html#12641a9e99a3064797647cf3b4946824" title="Encapsulates the NetwPkt into the MacPkt and sets the parameters.">encapsMsg</a>(pkt);
<a name="l00114"></a>00114         mac-&gt;setName(<span class="stringliteral">"MAC ERROR"</span>);
<a name="l00115"></a>00115         mac-&gt;setKind(<a class="code" href="a00017.html#49e0e548a6c20d002bd67afa7b76c483debf9c77bbe6f19772866cccbef0fe4b">PACKET_DROPPED</a>);
<a name="l00116"></a>00116         <a class="code" href="a00016.html#a1190a06fb4dfb15d8ff001468335dc8" title="Sends a control message to an upper layer.">sendControlUp</a>(mac);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         <span class="comment">//TODO: send packet drop bb info</span>
<a name="l00119"></a>00119         <span class="comment">//droppedPacket.setReason(DroppedPacket::QUEUE);</span>
<a name="l00120"></a>00120         <span class="comment">//utility-&gt;publishBBItem(catDroppedPacket, &amp;droppedPacket, nicId);</span>
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="660262c629f33b00401249d3fdac49be"></a><!-- doxytag: member="CSMAMacLayer::initialize" ref="660262c629f33b00401249d3fdac49be" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void CSMAMacLayer::initialize           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialization of the module and some variables. 
<p>

<p>Reimplemented from <a class="el" href="a00017.html#61c82dc3b225eac37f7fa9936c28c2c3">BaseMacLayer</a>.</p>

</div>
</div><p>
<a class="anchor" name="a4ace66cbd53164dc27f4fba70dd60b4"></a><!-- doxytag: member="CSMAMacLayer::scheduleBackoff" ref="a4ace66cbd53164dc27f4fba70dd60b4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSMAMacLayer::scheduleBackoff           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Inspect reasons for dropped packets. 
<p>
plus category from BB publish dropped packets nic wide schedule a backoff A non-persistent CSMA ideally uses a fixed backoff window, but it could also increase this window in a linear fashion, or even exponential -- here, a linear increase is used. Overwrite this function to define another schedule function. It also checks the retransmission counters -- if you overwrite it, do it with care. 
<p>Definition at line <a class="el" href="a00432.html#l00232">232</a> of file <a class="el" href="a00432.html">CSMAMacLayer.cc</a>.</p>

<p>References <a class="el" href="a00433.html#l00127">backoffTimer</a>, <a class="el" href="a00432.html#l00271">encapsMsg()</a>, <a class="el" href="a00090.html#8447e9cc66ba633aa11a59387cce477c">MacToPhyInterface::getRadioState()</a>, <a class="el" href="a00433.html#l00157">initialCW</a>, <a class="el" href="a00433.html#l00121">macQueue</a>, <a class="el" href="a00433.html#l00094">macState</a>, <a class="el" href="a00433.html#l00148">maxTxAttempts</a>, <a class="el" href="a00433.html#l00134">minorMsg</a>, <a class="el" href="a00339.html#l00053">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00339.html#l00061">BaseMacLayer::phy</a>, <a class="el" href="a00433.html#l00088">RX</a>, <a class="el" href="a00336.html#l00118">BaseLayer::sendControlUp()</a>, <a class="el" href="a00433.html#l00107">slotDuration</a>, and <a class="el" href="a00433.html#l00142">txAttempts</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00208">handleLowerControl()</a>, <a class="el" href="a00432.html#l00190">handleLowerMsg()</a>, <a class="el" href="a00432.html#l00128">handleSelfMsg()</a>, and <a class="el" href="a00432.html#l00091">handleUpperMsg()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <span class="keywordflow">if</span>(<a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>-&gt;isScheduled()) {
<a name="l00235"></a>00235         std::cerr &lt;&lt; <span class="stringliteral">" is scheduled: MAC state "</span>
<a name="l00236"></a>00236                   &lt;&lt; <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a> &lt;&lt; <span class="stringliteral">" radio state : "</span> &lt;&lt; <a class="code" href="a00017.html#a7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00090.html#8447e9cc66ba633aa11a59387cce477c" title="Returns the current state the radio is in. See RadioState for possible values.">getRadioState</a>() &lt;&lt; endl;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="keywordflow">if</span>(<a class="code" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b" title="count the number of tx attempts">txAttempts</a> &gt; <a class="code" href="a00051.html#e3aa6dae3903cabacbcafe783ef33d91" title="maximum number of transmission attempts">maxTxAttempts</a>) {
<a name="l00240"></a>00240         EV &lt;&lt; <span class="stringliteral">" drop packet "</span> &lt;&lt; endl;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         cMessage *mac = <a class="code" href="a00051.html#12641a9e99a3064797647cf3b4946824" title="Encapsulates the NetwPkt into the MacPkt and sets the parameters.">encapsMsg</a>(<a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.front());
<a name="l00243"></a>00243         mac-&gt;setName(<span class="stringliteral">"MAC ERROR"</span>);
<a name="l00244"></a>00244         mac-&gt;setKind(<a class="code" href="a00017.html#49e0e548a6c20d002bd67afa7b76c483debf9c77bbe6f19772866cccbef0fe4b">PACKET_DROPPED</a>);
<a name="l00245"></a>00245         <a class="code" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b" title="count the number of tx attempts">txAttempts</a> = 0;
<a name="l00246"></a>00246         <a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.pop_front();
<a name="l00247"></a>00247         <a class="code" href="a00016.html#a1190a06fb4dfb15d8ff001468335dc8" title="Sends a control message to an upper layer.">sendControlUp</a>(mac);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249         <span class="comment">//TODO: send packet drop bb info</span>
<a name="l00250"></a>00250         <span class="comment">//droppedPacket.setReason(DroppedPacket::CHANNEL);</span>
<a name="l00251"></a>00251         <span class="comment">//bb-&gt;publishBBItem(catDroppedPacket, &amp;droppedPacket, nicId);</span>
<a name="l00252"></a>00252     }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="keywordflow">if</span>(<a class="code" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19" title="cached pointer to radio module">macQueue</a>.size() != 0) {
<a name="l00255"></a>00255         EV &lt;&lt; <span class="stringliteral">" schedule backoff "</span> &lt;&lt; endl;
<a name="l00256"></a>00256         <a class="code" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b" title="count the number of tx attempts">txAttempts</a>++;
<a name="l00257"></a>00257         EV &lt;&lt; <span class="stringliteral">" attempts so far: "</span> &lt;&lt; <a class="code" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b" title="count the number of tx attempts">txAttempts</a>  &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; endl;
<a name="l00258"></a>00258         <span class="keywordtype">double</span> slots = intrand(<a class="code" href="a00051.html#8ec2aea0983e2149d3c7d1c06637dd70" title="initial contention window size">initialCW</a> - <a class="code" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b" title="count the number of tx attempts">txAttempts</a>) + 2.0*dblrand();
<a name="l00259"></a>00259         <span class="keywordtype">double</span> time = std::max(slots, 1.0) * <a class="code" href="a00051.html#420bec99b62f029c75996930bc5cb56f" title="RSSI level where medium is considered busy.">slotDuration</a>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="keywordflow">if</span>(<a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a>-&gt;isScheduled()){
<a name="l00262"></a>00262       cancelEvent( <a class="code" href="a00051.html#f06855c96a26dbe77937062bead7f82c" title="Multi-purpose message.">minorMsg</a> );
<a name="l00263"></a>00263       <a class="code" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907" title="kepp track of MAC state">macState</a>=<a class="code" href="a00051.html#a504ef94f12cc702c82a81f5f0654913b8f2c7ef825f0c569512139f5482e631">RX</a>;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         scheduleAt(simTime() + time, <a class="code" href="a00051.html#946e29bb8fead33566797a7062649a1e" title="Timer for backoff (non-persistent CSMA).">backoffTimer</a>);
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="946e29bb8fead33566797a7062649a1e"></a><!-- doxytag: member="CSMAMacLayer::backoffTimer" ref="946e29bb8fead33566797a7062649a1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="a00051.html#946e29bb8fead33566797a7062649a1e">CSMAMacLayer::backoffTimer</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<a class="el" href="a00137.html">Timer</a> for backoff (non-persistent CSMA). 
<p>

<p>Definition at line <a class="el" href="a00433.html#l00127">127</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00059">finish()</a>, <a class="el" href="a00432.html#l00208">handleLowerControl()</a>, <a class="el" href="a00432.html#l00190">handleLowerMsg()</a>, <a class="el" href="a00432.html#l00128">handleSelfMsg()</a>, <a class="el" href="a00432.html#l00091">handleUpperMsg()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="70ae938b76fa8fe65d97b0b511767894"></a><!-- doxytag: member="CSMAMacLayer::bitrate" ref="70ae938b76fa8fe65d97b0b511767894" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00051.html#70ae938b76fa8fe65d97b0b511767894">CSMAMacLayer::bitrate</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
the bit rate at which we transmit 
<p>

<p>Definition at line <a class="el" href="a00433.html#l00151">151</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00271">encapsMsg()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5a0fde63ac12cccfdb98bfe6314ce46d"></a><!-- doxytag: member="CSMAMacLayer::difs" ref="5a0fde63ac12cccfdb98bfe6314ce46d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00051.html#5a0fde63ac12cccfdb98bfe6314ce46d">CSMAMacLayer::difs</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Maximum time between a packet and its ACK. 
<p>
Usually this is slightly more then the tx-rx turnaround time The channel should stay clear within this period of time. 
<p>Definition at line <a class="el" href="a00433.html#l00114">114</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00128">handleSelfMsg()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8ec2aea0983e2149d3c7d1c06637dd70"></a><!-- doxytag: member="CSMAMacLayer::initialCW" ref="8ec2aea0983e2149d3c7d1c06637dd70" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="a00051.html#8ec2aea0983e2149d3c7d1c06637dd70">CSMAMacLayer::initialCW</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
initial contention window size 
<p>

<p>Definition at line <a class="el" href="a00433.html#l00157">157</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9869bd7667eacdb3a9c5f8ecb0c3ed19"></a><!-- doxytag: member="CSMAMacLayer::macQueue" ref="9869bd7667eacdb3a9c5f8ecb0c3ed19" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00051.html#f397ee30d94486721632bbcdad8274d1">MacQueue</a> <a class="el" href="a00051.html#9869bd7667eacdb3a9c5f8ecb0c3ed19">CSMAMacLayer::macQueue</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
cached pointer to radio module 
<p>
A queue to store packets from upper layer in case another packet is still waiting for transmission.. 
<p>Definition at line <a class="el" href="a00433.html#l00121">121</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00059">finish()</a>, <a class="el" href="a00432.html#l00208">handleLowerControl()</a>, <a class="el" href="a00432.html#l00128">handleSelfMsg()</a>, <a class="el" href="a00432.html#l00091">handleUpperMsg()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a78817d8e3bbf7850e5d84a6377ea907"></a><!-- doxytag: member="CSMAMacLayer::macState" ref="a78817d8e3bbf7850e5d84a6377ea907" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00051.html#a504ef94f12cc702c82a81f5f0654913">States</a> <a class="el" href="a00051.html#a78817d8e3bbf7850e5d84a6377ea907">CSMAMacLayer::macState</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
kepp track of MAC state 
<p>

<p>Definition at line <a class="el" href="a00433.html#l00094">94</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00208">handleLowerControl()</a>, <a class="el" href="a00432.html#l00128">handleSelfMsg()</a>, <a class="el" href="a00432.html#l00091">handleUpperMsg()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e3aa6dae3903cabacbcafe783ef33d91"></a><!-- doxytag: member="CSMAMacLayer::maxTxAttempts" ref="e3aa6dae3903cabacbcafe783ef33d91" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="a00051.html#e3aa6dae3903cabacbcafe783ef33d91">CSMAMacLayer::maxTxAttempts</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
maximum number of transmission attempts 
<p>
The packet is discarded when this number is reached. 
<p>Definition at line <a class="el" href="a00433.html#l00148">148</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f06855c96a26dbe77937062bead7f82c"></a><!-- doxytag: member="CSMAMacLayer::minorMsg" ref="f06855c96a26dbe77937062bead7f82c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cMessage* <a class="el" href="a00051.html#f06855c96a26dbe77937062bead7f82c">CSMAMacLayer::minorMsg</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Multi-purpose message. 
<p>
Keeps track of things like minimum time of clear channel (important for atomic acks) and race condition avoidance. 
<p>Definition at line <a class="el" href="a00433.html#l00134">134</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00059">finish()</a>, <a class="el" href="a00432.html#l00128">handleSelfMsg()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="27628021750dc0e8cf651382663276b8"></a><!-- doxytag: member="CSMAMacLayer::queueLength" ref="27628021750dc0e8cf651382663276b8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="a00051.html#27628021750dc0e8cf651382663276b8">CSMAMacLayer::queueLength</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
length of the queue 
<p>

<p>Definition at line <a class="el" href="a00433.html#l00124">124</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00091">handleUpperMsg()</a>.</p>

</div>
</div><p>
<a class="anchor" name="420bec99b62f029c75996930bc5cb56f"></a><!-- doxytag: member="CSMAMacLayer::slotDuration" ref="420bec99b62f029c75996930bc5cb56f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00051.html#420bec99b62f029c75996930bc5cb56f">CSMAMacLayer::slotDuration</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
RSSI level where medium is considered busy. 
<p>
Duration of a slot This duration can be a mini-slot (that is an RX-TX-turnaround time) but in general it should be the time it takes to send a packet plus some guard times (RX-TX-turnaround + a minimum inter-packet space). 
<p>Definition at line <a class="el" href="a00433.html#l00107">107</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00271">encapsMsg()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6c9b1b0f5eeb45db611633ca986f537b"></a><!-- doxytag: member="CSMAMacLayer::txAttempts" ref="6c9b1b0f5eeb45db611633ca986f537b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="a00051.html#6c9b1b0f5eeb45db611633ca986f537b">CSMAMacLayer::txAttempts</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
count the number of tx attempts 
<p>
This holds the number of transmission attempts, since no Acks are used this is the way how we can empty our queue even with overloaded channels. 
<p>Definition at line <a class="el" href="a00433.html#l00142">142</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00208">handleLowerControl()</a>, and <a class="el" href="a00432.html#l00232">scheduleBackoff()</a>.</p>

</div>
</div><p>
<a class="anchor" name="619cc05568e8ebef57ff9c551cd311d0"></a><!-- doxytag: member="CSMAMacLayer::txPower" ref="619cc05568e8ebef57ff9c551cd311d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00051.html#619cc05568e8ebef57ff9c551cd311d0">CSMAMacLayer::txPower</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The power at which we transmit. 
<p>

<p>Definition at line <a class="el" href="a00433.html#l00154">154</a> of file <a class="el" href="a00433.html">CSMAMacLayer.h</a>.</p>

<p>Referenced by <a class="el" href="a00432.html#l00271">encapsMsg()</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>modules/mac/<a class="el" href="a00433.html">CSMAMacLayer.h</a><li>modules/mac/<a class="el" href="a00432.html">CSMAMacLayer.cc</a></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 28 15:57:01 2009 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
