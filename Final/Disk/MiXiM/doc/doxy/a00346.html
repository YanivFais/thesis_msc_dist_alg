<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MiXiM: base/modules/BaseUtility.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1538cff59aa1d865678ab06d5aac9144.html">base</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c680c0e35fdcfce1b41b660e5b17b9f8.html">modules</a>
  </div>
</div>
<div class="contents">
<h1>BaseUtility.cc</h1><a href="a00169.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="a00170.html">BaseUtility.h</a>"</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include "<a class="code" href="a00172.html">BaseWorldUtility.h</a>"</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include "<a class="code" href="a00218.html">FindModule.h</a>"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include "<a class="code" href="a00223.html">Move.h</a>"</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <a class="code" href="a00146.html#7713f40391ce1dfc9b8330a6f4c13f90">Define_Module</a>(<a class="code" href="a00022.html" title="Provides a blackboard like information distribution.">BaseUtility</a>);
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">//BB start</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#ifndef coreEV</span>
<a name="l00012"></a><a class="code" href="a00169.html#27f667d27591f62ecf86a99a79ea8f42">00012</a> <span class="preprocessor"></span><span class="preprocessor">#define coreEV (ev.isDisabled()||!coreDebug) ? ev : ev &lt;&lt;getParentModule()-&gt;getName()&lt;&lt;"["&lt;&lt;getParentModule()-&gt;getIndex()&lt;&lt;"]::BaseUtility: "</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span>
<a name="l00015"></a><a class="code" href="a00169.html#e32e0edc902760a601f0f73f2791d538">00015</a> std::ostream&amp; <a class="code" href="a00169.html#e32e0edc902760a601f0f73f2791d538">operator&lt;&lt;</a>(std::ostream&amp; os, <span class="keyword">const</span> <a class="code" href="a00022.html#fafedb60f355bd4ed2162221d3adf4bf">BaseUtility::SubscriberVector</a>&amp; v)
<a name="l00016"></a>00016 {
<a name="l00017"></a>00017     os &lt;&lt; v.size() &lt;&lt; <span class="stringliteral">" client(s) "</span>;
<a name="l00018"></a>00018     BaseUtility::SubscriberVector::const_iterator it;
<a name="l00019"></a>00019     <span class="keywordflow">for</span> (it = v.begin(); it != v.end(); ++it)
<a name="l00020"></a>00020     {
<a name="l00021"></a>00021         os &lt;&lt; (it == v.begin() ? <span class="stringliteral">": "</span> : <span class="stringliteral">", "</span>);
<a name="l00022"></a>00022         <span class="keywordflow">if</span> (dynamic_cast&lt;cModule*&gt;((*it).client))
<a name="l00023"></a>00023         {
<a name="l00024"></a>00024             cModule *mod = <span class="keyword">dynamic_cast&lt;</span>cModule*<span class="keyword">&gt;</span>((*it).client);
<a name="l00025"></a>00025             os &lt;&lt; <span class="stringliteral">"mod ("</span> &lt;&lt; mod-&gt;getClassName() &lt;&lt; <span class="stringliteral">") "</span> &lt;&lt; mod-&gt;getFullName() &lt;&lt; <span class="stringliteral">" id="</span> &lt;&lt; mod-&gt;getId();
<a name="l00026"></a>00026         }
<a name="l00027"></a>00027         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;cObject*&gt;((*it).client))
<a name="l00028"></a>00028         {
<a name="l00029"></a>00029             cObject *obj = <span class="keyword">dynamic_cast&lt;</span>cObject*<span class="keyword">&gt;</span>((*it).client);
<a name="l00030"></a>00030             os &lt;&lt; <span class="stringliteral">"a "</span> &lt;&lt; obj-&gt;getClassName();
<a name="l00031"></a>00031         }
<a name="l00032"></a>00032         <span class="keywordflow">else</span>
<a name="l00033"></a>00033         {
<a name="l00034"></a>00034             os &lt;&lt; <span class="stringliteral">"a "</span> &lt;&lt; opp_typename(<span class="keyword">typeid</span>((*it).client));
<a name="l00035"></a>00035         }
<a name="l00036"></a>00036         os &lt;&lt; <span class="stringliteral">" scope: "</span> &lt;&lt; (*it).scopeModuleId;
<a name="l00037"></a>00037     }
<a name="l00038"></a>00038     <span class="keywordflow">return</span> os;
<a name="l00039"></a>00039 }
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="a00022.html#d57e8529a82be647510a942e31230785">00043</a> <a class="code" href="a00022.html#d57e8529a82be647510a942e31230785">BaseUtility::~BaseUtility</a>()
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045 }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">//BB end</span>
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="a00022.html#869c930fffedc7db68e652581f5869ce">00049</a> <span class="keywordtype">void</span> <a class="code" href="a00022.html#869c930fffedc7db68e652581f5869ce" title="Initializes mobility model parameters.">BaseUtility::initialize</a>(<span class="keywordtype">int</span> stage) {
<a name="l00050"></a>00050   <span class="comment">//BaseModule::initialize(stage);</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052   <span class="keywordflow">if</span> (stage == 0) {
<a name="l00053"></a>00053     hasPar(<span class="stringliteral">"coreDebug"</span>) ? <a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a> = par(<span class="stringliteral">"coreDebug"</span>).boolValue() : <a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a> = <span class="keyword">false</span>;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">//BB start</span>
<a name="l00056"></a>00056     WATCH_VECTOR(<a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>);
<a name="l00057"></a>00057       WATCH_VECTOR(<a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059       <a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>.clear();
<a name="l00060"></a>00060       <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.clear();
<a name="l00061"></a>00061       <a class="code" href="a00022.html#89c073aa186652a6a79524705e36d6ed">parentVector</a>.clear();
<a name="l00062"></a>00062       <a class="code" href="a00022.html#6b9f3907ab79dc7a09635c6997d66386">nextCategory</a> = 0;
<a name="l00063"></a>00063 <span class="comment">//BB end</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         <span class="comment">// subscribe to position changes</span>
<a name="l00066"></a>00066         <a class="code" href="a00097.html" title="Class to store object position and movement.">Move</a> moveBBItem;
<a name="l00067"></a>00067         <a class="code" href="a00022.html#9f343d30d7a2d07cdd94decb2373fd6e" title="BBItem category number of Move.">catMove</a> = <a class="code" href="a00022.html#15085a1024ff661074352fe3a7ab2ac6">subscribe</a>(<span class="keyword">this</span>, &amp;moveBBItem, <a class="code" href="a00022.html#b15a8f8aecd710865f3c1b5d19a8c630" title="Function to get a pointer to the host module.">findHost</a>()-&gt;getId());
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <a class="code" href="a00022.html#082e58bef27e919c87961d1f51ca2eb0" title="BBItem category number of HostState.">catHostState</a> = <a class="code" href="a00022.html#15085a1024ff661074352fe3a7ab2ac6">subscribe</a>(<span class="keyword">this</span>, &amp;<a class="code" href="a00022.html#f6be200acd5124414f6e52bbd6dee8ea" title="The hosts current state.">hostState</a>, <a class="code" href="a00022.html#b15a8f8aecd710865f3c1b5d19a8c630" title="Function to get a pointer to the host module.">findHost</a>()-&gt;getId());
<a name="l00070"></a>00070         <a class="code" href="a00022.html#f6be200acd5124414f6e52bbd6dee8ea" title="The hosts current state.">hostState</a>.<a class="code" href="a00071.html#403e773f87d00a6c66f3f017441de752" title="Sets the host state.">set</a>(<a class="code" href="a00071.html#5002302e0f07bbd982c6e5d65eaa9c3c24022de9465df959797f9b000cb87ad5">HostState::ACTIVE</a>);
<a name="l00071"></a>00071   }
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="a00022.html#b15a8f8aecd710865f3c1b5d19a8c630">00074</a> cModule *<a class="code" href="a00022.html#b15a8f8aecd710865f3c1b5d19a8c630" title="Function to get a pointer to the host module.">BaseUtility::findHost</a>(<span class="keywordtype">void</span>)
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076   <span class="keywordflow">return</span> <a class="code" href="a00022.html#b15a8f8aecd710865f3c1b5d19a8c630" title="Function to get a pointer to the host module.">FindModule&lt;&gt;::findHost</a>(<span class="keyword">this</span>);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="a00022.html#09c076194987b054b8ee6076b81b9336">00079</a> <span class="keywordtype">void</span> <a class="code" href="a00022.html#09c076194987b054b8ee6076b81b9336" title="This modules should only receive self-messages.">BaseUtility::handleMessage</a>(cMessage *msg) {
<a name="l00080"></a>00080   error(<span class="stringliteral">"This module does not handle any messages yet"</span>);
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 <span class="comment">/*</span>
<a name="l00083"></a>00083 <span class="comment">void BaseUtility::setPos(Coord* newCoord) {</span>
<a name="l00084"></a>00084 <span class="comment">  coreEV &lt;&lt; "Setting position to pos: " &lt;&lt; pos.info() &lt;&lt; endl;</span>
<a name="l00085"></a>00085 <span class="comment">  pos.setX(newCoord-&gt;getX());</span>
<a name="l00086"></a>00086 <span class="comment">  pos.setY(newCoord-&gt;getY());</span>
<a name="l00087"></a>00087 <span class="comment">  pos.setZ(newCoord-&gt;getZ());</span>
<a name="l00088"></a>00088 <span class="comment">}</span>
<a name="l00089"></a>00089 <span class="comment">*/</span>
<a name="l00090"></a>00090 
<a name="l00095"></a><a class="code" href="a00022.html#888ed3ecf5f55c680c85d4ba53624f0b">00095</a> <span class="keywordtype">void</span> <a class="code" href="a00022.html#888ed3ecf5f55c680c85d4ba53624f0b">BaseUtility::receiveBBItem</a>(<span class="keywordtype">int</span> category, <span class="keyword">const</span> <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *details, <span class="keywordtype">int</span> scopeModuleId)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <span class="comment">//BaseModule::receiveBBItem(category, details, scopeModuleId);</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="keywordflow">if</span>(category == <a class="code" href="a00022.html#9f343d30d7a2d07cdd94decb2373fd6e" title="BBItem category number of Move.">catMove</a>)
<a name="l00100"></a>00100     {
<a name="l00101"></a>00101         <span class="keyword">const</span> <a class="code" href="a00097.html" title="Class to store object position and movement.">Move</a>* m = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00097.html" title="Class to store object position and movement.">Move</a>*<span class="keyword">&gt;</span>(details);
<a name="l00102"></a>00102         <a class="code" href="a00022.html#e4427b4336a7d9c488bb40d6022f948d">pos</a> = m-&gt;<a class="code" href="a00097.html#84550b4f702ceed03c516754d17950f9" title="Start position of the host (in meters).">startPos</a>;
<a name="l00103"></a>00103         <a class="code" href="a00166.html#27f667d27591f62ecf86a99a79ea8f42">coreEV</a> &lt;&lt; <span class="stringliteral">"new HostMove: "</span> &lt;&lt; m-&gt;<a class="code" href="a00097.html#0287300e9580229fdd0c4c2c13e9527d">info</a>() &lt;&lt; endl;
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(category == <a class="code" href="a00022.html#082e58bef27e919c87961d1f51ca2eb0" title="BBItem category number of HostState.">catHostState</a>)
<a name="l00106"></a>00106     {
<a name="l00107"></a>00107       <span class="keyword">const</span> <a class="code" href="a00071.html" title="HostState is published by the battery to announce host failure.">HostState</a>* state = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00071.html" title="HostState is published by the battery to announce host failure.">HostState</a>*<span class="keyword">&gt;</span>(details);
<a name="l00108"></a>00108     <a class="code" href="a00022.html#f6be200acd5124414f6e52bbd6dee8ea" title="The hosts current state.">hostState</a> = *state;
<a name="l00109"></a>00109     <a class="code" href="a00166.html#27f667d27591f62ecf86a99a79ea8f42">coreEV</a> &lt;&lt; <span class="stringliteral">"new HostState: "</span> &lt;&lt; <a class="code" href="a00022.html#f6be200acd5124414f6e52bbd6dee8ea" title="The hosts current state.">hostState</a>.<a class="code" href="a00071.html#3b7466f384edafc0214e39265e27fef2">info</a>() &lt;&lt; endl;
<a name="l00110"></a>00110     }
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="comment">//BB start</span>
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="a00022.html#2ddb7de31d6e1abbde2ee4eeae689b7f">00116</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00022.html#2ddb7de31d6e1abbde2ee4eeae689b7f">BaseUtility::categoryName</a>(<span class="keywordtype">int</span> category)
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.size() &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>(category)) {
<a name="l00119"></a>00119         error(<span class="stringliteral">"BaseUtility::categoryName called with unknown category (%i)"</span>, category);
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121     <span class="keywordflow">return</span> <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>[category];
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="a00022.html#ec82cb8e6eaae844c4e9bedc2a899700">00124</a> <span class="keywordtype">int</span> <a class="code" href="a00022.html#ec82cb8e6eaae844c4e9bedc2a899700">BaseUtility::findAndCreateDescription</a>(<span class="keywordtype">bool</span> *isNewEntry, <span class="keyword">const</span> <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *category)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     CategoryDescriptions::size_type it;
<a name="l00128"></a>00128     std::string desc = category-&gt;getClassName();
<a name="l00129"></a>00129     std::string cName;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131     <span class="keywordflow">for</span>(it = 0; it &lt; <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.size(); ++it)
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133         cName = <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>[it];
<a name="l00134"></a>00134         <span class="keywordflow">if</span>(cName == desc) {
<a name="l00135"></a>00135             (*isNewEntry) = <span class="keyword">false</span>;
<a name="l00136"></a>00136             <span class="keywordflow">break</span>;
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139     <span class="keywordflow">if</span>(it == <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.size()) {
<a name="l00140"></a>00140         (*isNewEntry) = <span class="keyword">true</span>;
<a name="l00141"></a>00141         <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.push_back(category-&gt;getClassName());
<a name="l00142"></a>00142         it = <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.size() - 1;
<a name="l00143"></a>00143         <a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>.push_back(<a class="code" href="a00022.html#fafedb60f355bd4ed2162221d3adf4bf">SubscriberVector</a>());
<a name="l00144"></a>00144         <span class="keywordflow">if</span>(it != <a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>.size()-1)
<a name="l00145"></a>00145             error(<span class="stringliteral">"BaseUtility::findAndCreateDescription SubscriberVector creation failed"</span>);
<a name="l00146"></a>00146         <a class="code" href="a00022.html#89c073aa186652a6a79524705e36d6ed">parentVector</a>.push_back(-1);
<a name="l00147"></a>00147         <span class="keywordflow">if</span>(it != <a class="code" href="a00022.html#89c073aa186652a6a79524705e36d6ed">parentVector</a>.size()-1)
<a name="l00148"></a>00148             error(<span class="stringliteral">"BaseUtility::findAndCreateDescription ParentVector creation failed"</span>);
<a name="l00149"></a>00149         <a class="code" href="a00022.html#6b9f3907ab79dc7a09635c6997d66386">nextCategory</a> = <a class="code" href="a00022.html#adc937c8dc88cf1f6e1906e5db292932">categoryDescriptions</a>.size();
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(it);
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="a00022.html#03750e7d90227da3706664466e16514d">00154</a> <span class="keywordtype">void</span> <a class="code" href="a00022.html#03750e7d90227da3706664466e16514d">BaseUtility::fillParentVector</a>(<span class="keyword">const</span> <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *category, <span class="keywordtype">int</span> cat)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <span class="keywordtype">bool</span> isNewEntry = <span class="keyword">true</span>;
<a name="l00157"></a>00157     <span class="keywordtype">int</span> it;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *parentObject;
<a name="l00160"></a>00160     <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> base;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     parentObject = category-&gt;<a class="code" href="a00028.html#634d9d3b8527c5107d870c31893603c5">parentObject</a>();
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     <span class="keywordflow">if</span>(<span class="keyword">typeid</span>(*parentObject) != <span class="keyword">typeid</span>(base)) {
<a name="l00165"></a>00165         it = <a class="code" href="a00022.html#ec82cb8e6eaae844c4e9bedc2a899700">findAndCreateDescription</a>(&amp;isNewEntry, parentObject);
<a name="l00166"></a>00166         <a class="code" href="a00022.html#89c073aa186652a6a79524705e36d6ed">parentVector</a>[cat] = it;
<a name="l00167"></a>00167         <a class="code" href="a00022.html#03750e7d90227da3706664466e16514d">fillParentVector</a>(parentObject, it);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169     <span class="keyword">delete</span> parentObject;
<a name="l00170"></a>00170 }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="a00022.html#7498f88c493f269537b61df403ccb920">00174</a> <span class="keywordtype">int</span> <a class="code" href="a00022.html#15085a1024ff661074352fe3a7ab2ac6">BaseUtility::subscribe</a>(<a class="code" href="a00072.html" title="Clients can receive change notifications from the Blackboard via this interface.">ImNotifiable</a> *client, <span class="keywordtype">int</span> category, <span class="keywordtype">int</span> scopeModuleId)
<a name="l00175"></a>00175 {
<a name="l00176"></a>00176     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a>) {
<a name="l00177"></a>00177         Enter_Method(<span class="stringliteral">"subscribe(%s, %i)"</span>, <a class="code" href="a00022.html#2ddb7de31d6e1abbde2ee4eeae689b7f">categoryName</a>(category), scopeModuleId);
<a name="l00178"></a>00178     } <span class="keywordflow">else</span> {
<a name="l00179"></a>00179         Enter_Method_Silent();
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="comment">// find or create entry for this category</span>
<a name="l00183"></a>00183     <a class="code" href="a00022.html#fafedb60f355bd4ed2162221d3adf4bf">SubscriberVector</a>&amp; clients = <a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>[category];
<a name="l00184"></a>00184     SubscriberVector::const_iterator it;
<a name="l00185"></a>00185     <span class="keywordflow">for</span>(it = clients.begin(); it != clients.end(); ++it) {
<a name="l00186"></a>00186         <span class="keywordflow">if</span>((*it).client == client) {
<a name="l00187"></a>00187             std::string cname(<span class="stringliteral">"unkown"</span>);
<a name="l00188"></a>00188             cModule *cm = <span class="keyword">dynamic_cast&lt;</span>cModule *<span class="keyword">&gt;</span>(client);
<a name="l00189"></a>00189             <span class="keywordflow">if</span>(cm) cname = cm-&gt;getFullPath();
<a name="l00190"></a>00190             error(<span class="stringliteral">"BaseUtility::subscribe called twice for item %s, by client %s. \nThis probably means that a class from which you derived yours has \nalready subscribed to this item. This may result in conflicts, please check.\n "</span>, <a class="code" href="a00022.html#2ddb7de31d6e1abbde2ee4eeae689b7f">categoryName</a>(category), cname.c_str());
<a name="l00191"></a>00191             <span class="keywordflow">break</span>;
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194     <span class="comment">// add client if not already there</span>
<a name="l00195"></a>00195     <span class="keywordflow">if</span> (it == clients.end()) {
<a name="l00196"></a>00196         clients.push_back(<a class="code" href="a00023.html">Subscriber</a>(client, scopeModuleId));
<a name="l00197"></a>00197     }
<a name="l00198"></a>00198     <span class="keywordflow">return</span> category;
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="a00022.html#15085a1024ff661074352fe3a7ab2ac6">00201</a> <span class="keywordtype">int</span> <a class="code" href="a00022.html#15085a1024ff661074352fe3a7ab2ac6">BaseUtility::subscribe</a>(<a class="code" href="a00072.html" title="Clients can receive change notifications from the Blackboard via this interface.">ImNotifiable</a> *client, <span class="keyword">const</span> <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *category, <span class="keywordtype">int</span> scopeModuleId)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a>) {
<a name="l00204"></a>00204         Enter_Method(<span class="stringliteral">"subscribe(%s, %i)"</span>, category?category-&gt;getClassName() : <span class="stringliteral">"n/a"</span>,
<a name="l00205"></a>00205                      scopeModuleId);
<a name="l00206"></a>00206     } <span class="keywordflow">else</span> {
<a name="l00207"></a>00207         Enter_Method_Silent();
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209     CategoryDescriptions::size_type it = 0;
<a name="l00210"></a>00210     <span class="keywordtype">bool</span> isNewEntry;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212     <span class="keywordflow">if</span>(category) {
<a name="l00213"></a>00213         it = <a class="code" href="a00022.html#ec82cb8e6eaae844c4e9bedc2a899700">findAndCreateDescription</a>(&amp;isNewEntry, category);
<a name="l00214"></a>00214         <span class="keywordflow">if</span>(isNewEntry) <a class="code" href="a00022.html#03750e7d90227da3706664466e16514d">fillParentVector</a>(category, static_cast&lt;int&gt;(it));
<a name="l00215"></a>00215         <a class="code" href="a00022.html#15085a1024ff661074352fe3a7ab2ac6">subscribe</a>(client, static_cast&lt;int&gt;(it), scopeModuleId);
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217     <span class="keywordflow">else</span> {
<a name="l00218"></a>00218         error(<span class="stringliteral">"BaseUtility::subscribe called without category item"</span>);
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(it);
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="a00022.html#711ade8bf44aeb86ac3fbc22f1932b33">00223</a> <span class="keywordtype">void</span> <a class="code" href="a00022.html#711ade8bf44aeb86ac3fbc22f1932b33">BaseUtility::unsubscribe</a>(<a class="code" href="a00072.html" title="Clients can receive change notifications from the Blackboard via this interface.">ImNotifiable</a> *client, <span class="keywordtype">int</span> category)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a>) {
<a name="l00226"></a>00226         Enter_Method(<span class="stringliteral">"unsubscribe(%s)"</span>, <a class="code" href="a00022.html#2ddb7de31d6e1abbde2ee4eeae689b7f">categoryName</a>(category));
<a name="l00227"></a>00227     } <span class="keywordflow">else</span> {
<a name="l00228"></a>00228         Enter_Method_Silent();
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230     <span class="comment">// find (or create) entry for this category</span>
<a name="l00231"></a>00231     <a class="code" href="a00022.html#fafedb60f355bd4ed2162221d3adf4bf">SubscriberVector</a>&amp; clients = <a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>[category];
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     <span class="comment">// remove client if there</span>
<a name="l00234"></a>00234     SubscriberVector::iterator it;
<a name="l00235"></a>00235     <span class="keywordflow">for</span>(it = clients.begin(); it != clients.end(); ++it) {
<a name="l00236"></a>00236         <span class="keywordflow">if</span>((*it).client == client) clients.erase(it);
<a name="l00237"></a>00237         <span class="keywordflow">break</span>;
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="a00022.html#f3e375a774329f553ddc670b737443a5">00241</a> <span class="keywordtype">void</span> <a class="code" href="a00022.html#f3e375a774329f553ddc670b737443a5">BaseUtility::publishBBItem</a>(<span class="keywordtype">int</span> category, <span class="keyword">const</span> <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *details, <span class="keywordtype">int</span> scopeModuleId)
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a>) {
<a name="l00244"></a>00244         Enter_Method(<span class="stringliteral">"publish(%s, %s, %i)"</span>, <a class="code" href="a00022.html#2ddb7de31d6e1abbde2ee4eeae689b7f">categoryName</a>(category),
<a name="l00245"></a>00245                      details?details-&gt;info().c_str() : <span class="stringliteral">"n/a"</span>, scopeModuleId);
<a name="l00246"></a>00246     } <span class="keywordflow">else</span> {
<a name="l00247"></a>00247         Enter_Method_Silent();
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="keywordtype">int</span> pCat;
<a name="l00251"></a>00251     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>.size() &gt; 0) {
<a name="l00252"></a>00252         SubscriberVector::const_iterator j;
<a name="l00253"></a>00253         <span class="keywordflow">for</span> (j=<a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>[category].begin(); j!=<a class="code" href="a00022.html#9407b9a98a825c1556392ec181d5b2b2">clientVector</a>[category].end(); ++j)
<a name="l00254"></a>00254         {
<a name="l00255"></a>00255             <span class="keywordflow">if</span>(((*j).scopeModuleId == -1) || ((*j).scopeModuleId == scopeModuleId))
<a name="l00256"></a>00256             {
<a name="l00257"></a>00257                 (*j).client-&gt;receiveBBItem(category, details, scopeModuleId);
<a name="l00258"></a>00258             }
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260         pCat = <a class="code" href="a00022.html#89c073aa186652a6a79524705e36d6ed">parentVector</a>[category];
<a name="l00261"></a>00261         <span class="keywordflow">if</span>(pCat &gt;= 0) <a class="code" href="a00022.html#f3e375a774329f553ddc670b737443a5">publishBBItem</a>(pCat, details, scopeModuleId);
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="a00022.html#d8ed51fa1714dcdce0b294e6e3c74408">00265</a> <span class="keywordtype">int</span> <a class="code" href="a00022.html#d8ed51fa1714dcdce0b294e6e3c74408">BaseUtility::getCategory</a>(<span class="keyword">const</span> <a class="code" href="a00028.html" title="Contains detailed information about the items published using the BB.">BBItem</a> *details)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <span class="keywordflow">if</span>(<a class="code" href="a00022.html#eec15bd75df68ead143f852341d47a89">coreDebug</a>) {
<a name="l00268"></a>00268         Enter_Method(<span class="stringliteral">"getCategory(%s)"</span>, details?details-&gt;getClassName():<span class="stringliteral">"n/a"</span>);
<a name="l00269"></a>00269     } <span class="keywordflow">else</span> {
<a name="l00270"></a>00270         Enter_Method_Silent();
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordtype">int</span> category = -1;
<a name="l00273"></a>00273     <span class="keywordtype">bool</span> isNewEntry;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">if</span>(details) {
<a name="l00276"></a>00276         category = <a class="code" href="a00022.html#ec82cb8e6eaae844c4e9bedc2a899700">findAndCreateDescription</a>(&amp;isNewEntry, details);
<a name="l00277"></a>00277         <span class="keywordflow">if</span>(isNewEntry) <a class="code" href="a00022.html#03750e7d90227da3706664466e16514d">fillParentVector</a>(details, category);
<a name="l00278"></a>00278     } <span class="keywordflow">else</span> {
<a name="l00279"></a>00279         error(<span class="stringliteral">"BaseUtility::getCategory called without category item"</span>);
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     <span class="keywordflow">return</span> category;
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">//BB end</span>
<a name="l00285"></a>00285 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Sep 28 15:56:34 2009 for MiXiM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
